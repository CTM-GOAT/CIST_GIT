version: 2.1
jobs:
  build:
    docker:
      - image: wdoogz/ansible:latest
    steps:
      - checkout
      - add_ssh_keys:
          fingerprints:
            - "07:1f:fb:d5:67:be:5a:bb:69:6d:b0:be:ab:15:5a:2d"
      - run: |
          if [[ -n ${CIRCLE_PULL_REQUEST} ]]; then
            for i in $(ls ./playbooks/); do
              ansible-lint ./playbooks/$i
            done
          else
            cp ./hosts /etc/ansible/hosts
            for i in $(ls ./playbooks/); do
              ansible-playbook ./playbooks/$i
            done
          fi    
